# Widget System Documentation

## Overview

The Adealo Widget System is a lightweight, high-performance chat widget that can be easily embedded into any website. The widget allows website visitors to interact with your team through chat, book demos, or request callbacks.

Our widget system uses a **vanilla JavaScript approach** that generates all HTML, CSS, and JavaScript dynamically based on a configuration object. This approach offers significant advantages over traditional component-based frameworks.

![Widget System Architecture](https://via.placeholder.com/800x400?text=Widget+System+Architecture)

## Key Benefits

### 1. Performance
- **Zero Dependencies**: No React, ReactDOM, or other external libraries required
- **Faster Loading**: Smaller file size means quicker initialization
- **Reduced Memory Usage**: Minimal JavaScript footprint

### 2. Simplicity
- **Single Script Tag**: Users only need to include one script tag in their HTML
- **No Build Process**: No need for bundling or transpilation
- **Self-Contained**: All functionality is included in a single script

### 3. Customization
- **Configuration-Driven**: All styling and behavior is derived from a configuration object
- **Dynamic Generation**: UI elements are created on-the-fly based on configuration
- **Theming Support**: Easy to customize colors, fonts, and other visual elements

### 4. Reduced Network Requests
- **No Separate CSS**: Styles are applied directly to elements via JavaScript
- **No Component Bundles**: No need to load separate component files
- **Efficient Caching**: Configuration is cached locally for improved performance

## How It Works

1. **Script Inclusion**: Website owner adds a single script tag to their site
2. **Configuration Retrieval**: Script fetches the widget configuration from our API
3. **Dynamic Generation**: JavaScript creates all necessary DOM elements with inline styles
4. **Event Handling**: Script sets up event listeners for user interactions
5. **API Integration**: Widget communicates with our backend for chat, booking, etc.

## Implementation Guide

### Adding the Widget to Your Website

Add the following script tag to your website's HTML, preferably just before the closing `</body>` tag:

```html
<script src="https://widget.adealo.com/widget?widgetId=YOUR_WIDGET_ID"></script>
```

Replace `YOUR_WIDGET_ID` with your unique widget identifier.

### Configuration Options

The widget's appearance and behavior are controlled by a configuration object stored in our database. You can customize this configuration through the Adealo dashboard.

Key configuration sections include:

- **Base**: Basic widget information (name, status, etc.)
- **Design**: Visual appearance (colors, position, animations, etc.)
- **Features**: Enabled features and their settings
- **Content**: Text content and labels
- **Chat Config**: Chat-specific settings

## Widget Features

### Chat

The chat feature allows visitors to communicate with your team in real-time or leave messages when offline.

**Key Settings:**
- Greeting message
- Team name and agent information
- Typing indicators
- Timestamps and read receipts
- Offline messaging

### Book Demo

The book demo feature allows visitors to schedule a demonstration of your product or service.

**Key Settings:**
- Calendly integration
- Title and description
- Team member selection
- Pre-qualification questions

### Call Me

The call me feature allows visitors to request a phone call from your team.

**Key Settings:**
- Response time options
- Qualification questions
- Team member selection
- Success messages

## Technical Implementation

### Widget Generation

The widget script is generated by the `generateEnhancedWidgetScript` function in `widget-config.ts`. This function:

1. Takes a widget configuration object
2. Generates a self-contained JavaScript function
3. Creates all necessary DOM elements
4. Applies styles directly to those elements
5. Sets up event handlers for user interactions

### Configuration Retrieval

The widget configuration is retrieved from our API using the `getWidgetConfigHttp` endpoint. This endpoint:

1. Accepts a widget ID as a query parameter
2. Retrieves the configuration from the database
3. Returns the configuration as JSON
4. Tracks widget views for analytics

### Interaction Tracking

All widget interactions are tracked using the `trackWidgetInteractionHttp` endpoint. This endpoint:

1. Records the type of interaction (open, close, chat, etc.)
2. Stores additional data about the interaction
3. Updates widget statistics

## Testing and Deployment

### Testing Widget Changes

To test changes to your widget:

1. Make changes to your widget configuration in the Adealo dashboard
2. Save the changes
3. Preview the widget using the built-in preview tool
4. Test on your website by refreshing the page

### Deploying Widget Updates

Widget updates are deployed automatically when you save changes in the dashboard. The changes will be reflected on your website immediately or after the configuration cache expires (typically 1 hour).

## Troubleshooting

### Common Issues

1. **Widget not appearing**: Check that the script tag is correctly placed and the widget ID is valid
2. **Styling issues**: Verify your design configuration, especially colors and positioning
3. **Feature not working**: Ensure the feature is enabled in your configuration

### Debugging

The widget logs information to the browser console. Open your browser's developer tools and check the console for any error messages or warnings.

## Migration from React-based Widget

If you're migrating from our previous React-based widget implementation, note that:

1. The new vanilla JS approach is fully backward compatible
2. All existing configurations will continue to work
3. No changes are needed to your website's HTML
4. Performance should be significantly improved

## API Reference

For detailed information about the widget configuration API, see the [API Reference](API-REFERENCE.md).

## Support

If you need assistance with the widget system, please contact our support team at support@adealo.com.
