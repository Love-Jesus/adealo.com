<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales-Focused Chat Widget</title>
    (function () {
      function getWidgetId() {
          try {
              if (window.ADEALO_WIDGET_ID) return window.ADEALO_WIDGET_ID;
              const configWidgetId = window.widgetConfig && window.widgetConfig.id ? window.widgetConfig.id : null;
              if (configWidgetId) return configWidgetId;
              const dataWidgetId = document.currentScript ? document.currentScript.getAttribute('data-widget-id') : null;
              if (dataWidgetId) return dataWidgetId;
              const getScriptUrlParameter = function (name) {
                  if (!document.currentScript || !document.currentScript.src) return '';
                  name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                  var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                  var results = regex.exec(document.currentScript.src);
                  return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
              };
              const scriptUrlWidgetId = getScriptUrlParameter('widgetId');
              if (scriptUrlWidgetId) return scriptUrlWidgetId;
              const getUrlParameter = function (name) {
                  name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                  var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                  var results = regex.exec(location.search);
                  return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
              };
              const urlWidgetId = getUrlParameter('widgetId');
              if (urlWidgetId) return urlWidgetId;
              const scripts = document.getElementsByTagName('script');
              for (let i = 0; i < scripts.length; i++) {
                  const scriptDataWidgetId = scripts[i].getAttribute('data-widget-id');
                  if (scriptDataWidgetId) return scriptDataWidgetId;
              }
              return 'WnwIUWLRHxM09A6EYJPY'; // Default for testing
          } catch (error) {
              console.error('Error in getWidgetId:', error);
              return null;
          }
      }
  
      const widgetId = getWidgetId();
      if (!widgetId) {
          console.error('Widget Error: Missing widgetId parameter');
          return;
      }
  
      let container = document.getElementById('adealo-widget-container');
      if (!container) {
          container = document.createElement('div');
          container.id = 'adealo-widget-container';
          document.body.appendChild(container);
      }
  
      async function fetchWidgetConfig() {
          try {
              const API_URL = 'https://us-central1-adealo-ce238.cloudfunctions.net';
              const response = await fetch(`${API_URL}/getWidgetConfigHttp?widgetId=${widgetId}`);
              if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
              return await response.json();
          } catch (error) {
              console.error('Error fetching widget configuration:', error);
              return null;
          }
      }
  
      let lastInteraction = 0;
      function trackInteraction(eventType, data = {}) {
          try {
              const now = Date.now();
              if (now - lastInteraction < 500) return;
              lastInteraction = now;
              const API_URL = 'https://us-central1-adealo-ce238.cloudfunctions.net';
              fetch(`${API_URL}/trackWidgetInteractionHttp`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                      widgetId,
                      eventType,
                      data,
                      timestamp: new Date().toISOString(),
                      url: window.location.href,
                      referrer: document.referrer,
                      userAgent: navigator.userAgent
                  })
              }).catch(error => console.error('Error tracking interaction:', error));
          } catch (error) {
              console.error('Error tracking widget interaction:', error);
          }
      }
  
      async function initWidget() {
          let config = window.widgetConfig || {};
          if (!config.design) {
              config = await fetchWidgetConfig();
              if (!config) {
                  console.error('Widget Error: Failed to fetch widget configuration');
                  config = {
                      design: {
                          position: 'bottom-right',
                          colors: { primary: '#000' },
                          launcher: { size: 60 }
                      },
                      content: { greeting: 'Hello!', tagline: 'How can we help?' }
                  };
              }
          }
  
          const style = document.createElement('style');
          style.textContent = `
              @keyframes fadeIn {
                  from { opacity: 0; transform: translateY(10px); }
                  to { opacity: 1; transform: translateY(0); }
              }
              @keyframes slideInRight {
                  from { transform: translateX(20px); opacity: 0; }
                  to { transform: translateX(0); opacity: 1; }
              }
              @keyframes slideOutLeft {
                  from { transform: translateX(0); opacity: 1; }
                  to { transform: translateX(-20px); opacity: 0; }
              }
              @keyframes slideInLeft {
                  from { transform: translateX(-20px); opacity: 0; }
                  to { transform: translateX(0); opacity: 1; }
              }
              @keyframes slideOutRight {
                  from { transform: translateX(0); opacity: 1; }
                  to { transform: translateX(20px); opacity: 0; }
              }
              @keyframes pulse-animation-${widgetId} {
                  0% { box-shadow: 0 0 0 0 rgba(var(--pulse-color), 0.7); }
                  70% { box-shadow: 0 0 0 10px rgba(var(--pulse-color), 0); }
                  100% { box-shadow: 0 0 0 0 rgba(var(--pulse-color), 0); }
              }
              @keyframes typingDots {
                  0% { content: '.'; }
                  33% { content: '..'; }
                  66% { content: '...'; }
                  100% { content: '.'; }
              }
              @keyframes messageFadeIn {
                  from { opacity: 0; transform: translateY(10px); }
                  to { opacity: 1; transform: translateY(0); }
              }
              @keyframes widgetEntranceAnimation {
                  0% { transform: scale(0.3); opacity: 0; }
                  70% { transform: scale(1.05); }
                  100% { transform: scale(1); opacity: 1; }
              }
              @keyframes arrowRotateDown {
                  from { transform: rotate(0deg); }
                  to { transform: rotate(180deg); }
              }
              @keyframes arrowRotateUp {
                  from { transform: rotate(180deg); }
                  to { transform: rotate(0deg); }
              }
              .fade-in { animation: fadeIn 0.3s ease forwards; }
              .slide-in-right { animation: slideInRight 0.3s ease forwards; }
              .slide-out-left { animation: slideOutLeft 0.3s ease forwards; }
              .slide-in-left { animation: slideInLeft 0.3s ease forwards; }
              .slide-out-right { animation: slideOutRight 0.3s ease forwards; }
              .message-fade-in { animation: messageFadeIn 0.3s ease forwards; }
              .widget-entrance { animation: widgetEntranceAnimation 0.5s ease forwards; }
              .typing-indicator {
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  width: 40px;
                  height: 24px;
                  background-color: #E0E0E0;
                  border-radius: 12px;
              }
              .typing-indicator::after {
                  content: '.';
                  display: inline-block;
                  animation: typingDots 1.5s infinite;
                  width: 20px;
                  text-align: left;
                  font-size: 16px;
                  color: #666666;
              }
              .adealo-widget {
                  font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                  line-height: 1.5;
                  display: flex;
                  flex-direction: column;
              }
              .adealo-widget button:focus,
              .adealo-widget input:focus {
                  outline: none;
              }
              .adealo-widget button:hover {
                  opacity: 0.9;
                  transition: opacity 0.2s ease;
              }
              .adealo-widget input {
                  transition: all 0.2s ease;
              }
              .action-card {
                  transition: transform 0.2s ease, box-shadow 0.2s ease;
              }
              .action-card:hover {
                  transform: translateY(-1px);
                  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
              }
              .premium-border {
                  border: 1px solid rgba(0, 0, 0, 0.08);
                  border-radius: 12px;
              }
              .elevated-shadow {
                  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
              }
              .smooth-transition {
                  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
              }
              .emoji-menu {
                  position: absolute;
                  bottom: 60px;
                  left: 20px;
                  background: #FFFFFF;
                  border: 1px solid #E0E0E0;
                  border-radius: 8px;
                  padding: 10px;
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                  display: none;
                  z-index: 1001;
              }
              .emoji-menu span {
                  font-size: 20px;
                  margin: 5px;
                  cursor: pointer;
              }
              .emoji-menu span:hover {
                  background: #F0F0F0;
                  border-radius: 4px;
              }
              .launcher-hover {
                  transition: transform 0.3s ease;
              }
              .launcher-hover:hover {
                  transform: scale(1.1);
              }
              .launcher-hover:active {
                  transform: scale(0.95);
              }
              .chat-input-container {
                  display: flex;
                  align-items: center;
                  background-color: #FFFFFF;
                  border-radius: 30px;
                  padding: 8px 16px;
                  margin: 0 16px 16px 16px;
                  border: 1px solid #E0E0E0;
                  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                  width: calc(100% - 32px);
              }
              .chat-input {
                  flex: 1;
                  border: none;
                  outline: none;
                  font-size: 14px;
                  padding: 8px 0;
              }
              .chat-send-button {
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  width: 40px;
                  height: 40px;
                  border-radius: 50%;
                  background: linear-gradient(135deg, #000000, #333333);
                  color: white;
                  border: none;
                  cursor: pointer;
                  margin-left: 8px;
              }
              .chat-emoji-button {
                  background: none;
                  border: none;
                  cursor: pointer;
                  color: #666;
                  padding: 0;
                  margin-right: 8px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
              }
              .user-message-bubble {
                  background: linear-gradient(135deg, #000000, #333333);
                  color: white;
                  border-radius: 16px 0 16px 16px;
                  padding: 12px 16px;
                  max-width: 100%;
                  align-self: flex-end;
                  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                  margin-left: auto;
                  word-wrap: break-word;
              }
              .agent-message-bubble {
                  background-color: #E0E0E0;
                  color: #000000;
                  border-radius: 0 16px 16px 16px;
                  padding: 12px 16px;
                  max-width: 80%;
                  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
                  word-wrap: break-word;
              }
              .arrow-icon {
                  transition: transform 0.3s ease;
              }
          `;
          document.head.appendChild(style);
  
          container.classList.add('adealo-widget');
          container.style.position = 'fixed';
          container.style.zIndex = '9999';
          container.style.boxShadow = 'none';
          container.style.borderRadius = '16px';
  
          switch (config.design?.position) {
              case 'bottom-right':
                  container.style.bottom = '20px';
                  container.style.right = '20px';
                  break;
              case 'bottom-left':
                  container.style.bottom = '20px';
                  container.style.left = '20px';
                  break;
              case 'top-right':
                  container.style.top = '20px';
                  container.style.right = '20px';
                  break;
              case 'top-left':
                  container.style.top = '20px';
                  container.style.left = '20px';
                  break;
              default:
                  container.style.bottom = '20px';
                  container.style.right = '20px';
          }
  
          const button = document.createElement('button');
          button.id = 'adealo-widget-button-' + widgetId;
          button.setAttribute('aria-label', 'Open widget');
          button.classList.add('launcher-hover');
          const launcherSize = config.design?.launcher?.size || 60;
          button.style.width = launcherSize + 'px';
          button.style.height = launcherSize + 'px';
          button.style.borderRadius = config.design?.launcher?.shape === 'rounded-square' ? (config.design?.borderRadius || 8) + 'px' : '50%';
          button.style.backgroundColor = config.design?.colors?.primary || '#000';
          button.style.color = '#FFFFFF';
          button.style.border = 'none';
          button.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';
          button.style.cursor = 'pointer';
          button.style.display = 'flex';
          button.style.alignItems = 'center';
          button.style.justifyContent = 'center';
          button.style.transition = 'all 0.3s ease';
          button.style.zIndex = '9998';
  
          if (config.design?.launcher?.useGradient && config.design?.colors?.gradient) {
              const gradient = config.design.colors.gradient;
              button.style.background = gradient.type === 'linear' 
                  ? `linear-gradient(${gradient.direction || '135deg'}, ${gradient.colors.join(', ')})`
                  : `radial-gradient(circle, ${gradient.colors.join(', ')})`;
          } else {
              // Default gradient for launcher
              button.style.background = 'linear-gradient(135deg, #000000, #333333)';
          }
  
          const chatIconSVG = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>';
          const arrowDownSVG = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="arrow-icon"><path d="M6 9l6 6 6-6"/></svg>';
          button.innerHTML = chatIconSVG;
  
          if (config.design?.launcher?.pulseAnimation) {
              let primaryColor = config.design?.colors?.primary || '#000';
              if (primaryColor.startsWith('#')) {
                  const r = parseInt(primaryColor.slice(1, 3), 16);
                  const g = parseInt(primaryColor.slice(3, 5), 16);
                  const b = parseInt(primaryColor.slice(5, 7), 16);
                  button.style.setProperty('--pulse-color', `${r}, ${g}, ${b}`);
              }
              button.style.animation = `pulse-animation-${widgetId} 2s infinite`;
          }
  
          const content = document.createElement('div');
          content.id = 'adealo-widget-content-' + widgetId;
          content.setAttribute('role', 'dialog');
          content.setAttribute('aria-label', 'Adealo Widget');
          content.style.display = 'none'; // Initially hidden, will be shown when launcher is clicked
          content.style.width = '380px';
          content.style.height = '550px'; // Fixed height of 550px
          content.style.backgroundColor = '#F5F5F5';
          content.style.color = '#000000';
          content.style.borderRadius = '16px';
          content.style.overflow = 'hidden';
          content.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.3)';
          content.style.flexDirection = 'column';
          content.style.position = 'absolute';
          content.style.zIndex = '9997';
  
          switch (config.design?.position) {
              case 'bottom-right':
                  content.style.bottom = launcherSize + 10 + 'px';
                  content.style.right = '0';
                  break;
              case 'bottom-left':
                  content.style.bottom = launcherSize + 10 + 'px';
                  content.style.left = '0';
                  break;
              case 'top-right':
                  content.style.top = launcherSize + 10 + 'px';
                  content.style.right = '0';
                  break;
              case 'top-left':
                  content.style.top = launcherSize + 10 + 'px';
                  content.style.left = '0';
                  break;
              default:
                  content.style.bottom = launcherSize + 10 + 'px';
                  content.style.right = '0';
          }
  
          const header = document.createElement('div');
          header.style.background = 'linear-gradient(135deg, #000000, #333333)';
          header.style.color = '#FFFFFF';
          header.style.padding = '40px 20px'; // Taller header
          header.style.position = 'relative';
          header.style.flexShrink = '0';
          header.style.textAlign = 'left'; // Left-aligned text
  
          const title = document.createElement('h3');
          title.style.margin = '0 0 8px 0';
          title.style.fontSize = '24px';
          title.style.fontWeight = '400';
          title.textContent = config.content?.greeting || 'Hey 👋';
  
          const description = document.createElement('p');
          description.style.margin = '0';
          description.style.fontSize = '20px';
          description.style.fontWeight = '600';
          description.textContent = config.content?.tagline || 'How can we assist you today?';
  
          // Removed the header close button as requested
  
          header.appendChild(title);
          header.appendChild(description);
  
          const navBar = document.createElement('div');
          navBar.style.height = '56px';
          navBar.style.padding = '0 20px';
          navBar.style.display = 'flex';
          navBar.style.alignItems = 'center';
          navBar.style.justifyContent = 'space-between';
          navBar.style.borderBottom = '1px solid #E0E0E0';
          navBar.style.backgroundColor = '#F5F5F5';
          navBar.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
          navBar.style.display = 'none';
  
          const navLeft = document.createElement('div');
          navLeft.style.display = 'flex';
          navLeft.style.alignItems = 'center';
          navLeft.style.gap = '12px';
  
          const backButton = document.createElement('button');
          backButton.setAttribute('aria-label', 'Back to home');
          backButton.style.background = 'none';
          backButton.style.border = 'none';
          backButton.style.cursor = 'pointer';
          backButton.style.color = '#000000';
          backButton.innerHTML = `
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
          `;
  
          const navTitle = document.createElement('div');
          navTitle.style.display = 'flex';
          navTitle.style.flexDirection = 'column';
          navTitle.innerHTML = `
              <div style="font-size: 16px; font-weight: 600; color: #000000;"></div>
              <div style="font-size: 12px; color: #666666;"></div>
          `;
  
          const navRight = document.createElement('div');
          navRight.style.display = 'flex';
          navRight.style.alignItems = 'center';
          navRight.style.gap = '12px';
  
          // Removed the nav close button as requested
  
          navLeft.appendChild(backButton);
          navLeft.appendChild(navTitle);
          navBar.appendChild(navLeft);
          navBar.appendChild(navRight);
  
          const contentArea = document.createElement('div');
          contentArea.style.flex = '1';
          contentArea.style.overflowY = 'auto';
          contentArea.style.position = 'relative';
          contentArea.style.backgroundColor = '#FFFFFF';
          contentArea.style.display = 'flex';
          contentArea.style.flexDirection = 'column';
  
          content.appendChild(header);
          content.appendChild(navBar);
          content.appendChild(contentArea);
          container.appendChild(button);
          container.appendChild(content);
  
          let currentScreen = null; // Initialize as null to force initial render
  
          function showScreen(screenName, direction = 'forward') {
              console.log(`showScreen called with screenName: ${screenName}`);
  
              // Clear the content area
              contentArea.innerHTML = '';
              contentArea.style.opacity = '0';
              contentArea.classList.remove('slide-in-left', 'slide-out-right', 'slide-in-right', 'slide-out-left');
  
              if (direction === 'forward') {
                  contentArea.classList.add('slide-out-left');
              } else {
                  contentArea.classList.add('slide-out-right');
              }
  
              try {
                  switch (screenName) {
                      case 'home':
                          header.style.display = 'block';
                          navBar.style.display = 'none';
                          contentArea.style.height = 'auto';
                          showHomeScreen(contentArea);
                          break;
                      case 'support':
                          header.style.display = 'none';
                          navBar.style.display = 'flex';
                          contentArea.style.height = '100%';
                          navTitle.children[0].textContent = 'Support';
                          navTitle.children[1].textContent = 'Chat with us';
                          showSupportScreen(contentArea);
                          break;
                      case 'book-demo':
                          header.style.display = 'none';
                          navBar.style.display = 'flex';
                          contentArea.style.height = '100%';
                          navTitle.children[0].textContent = 'Book a Demo';
                          navTitle.children[1].textContent = 'Schedule a consultation';
                          showBookDemoScreen(contentArea);
                          break;
                      case 'call-me':
                          header.style.display = 'none';
                          navBar.style.display = 'flex';
                          contentArea.style.height = '100%';
                          navTitle.children[0].textContent = 'Call Me';
                          navTitle.children[1].textContent = 'Request a callback';
                          showCallMeScreen(contentArea);
                          break;
                      default:
                          console.error(`Unknown screen: ${screenName}`);
                          return;
                  }
              } catch (error) {
                  console.error(`Error in showScreen for ${screenName}:`, error);
                  return;
              }
  
              contentArea.classList.remove('slide-out-left', 'slide-out-right');
              contentArea.classList.add(direction === 'forward' ? 'slide-in-right' : 'slide-in-left');
              contentArea.style.opacity = '1';
              trackInteraction(`view_${screenName}_screen`);
              currentScreen = screenName;
          }
  
          function showHomeScreen(contentArea) {
              console.log('showHomeScreen called');
              const actionsSection = document.createElement('div');
              actionsSection.style.padding = '20px 30px';
              actionsSection.style.display = 'flex';
              actionsSection.style.flexDirection = 'column';
              actionsSection.style.gap = '20px';
              actionsSection.style.alignItems = 'center';
              actionsSection.style.justifyContent = 'center';
              actionsSection.style.flex = '1';
              actionsSection.style.background = 'linear-gradient(180deg, #F5F5F5 0%, #FFFFFF 100%)';
  
              function createActionCard(icon, title, onClick) {
                  console.log(`Creating action card: ${title}`);
                  const card = document.createElement('div');
                  card.classList.add('action-card');
                  card.style.display = 'flex';
                  card.style.alignItems = 'center';
                  card.style.justifyContent = 'space-between';
                  card.style.padding = '16px 20px';
                  card.style.backgroundColor = '#FFFFFF';
                  card.style.border = '1px solid #EAEAEA';
                  card.style.borderRadius = '12px';
                  card.style.cursor = 'pointer';
                  card.style.width = '100%';
                  card.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.08)';
                  card.setAttribute('role', 'button');
                  card.setAttribute('aria-label', title);
  
                  card.innerHTML = `
                      <div style="display: flex; align-items: center;">
                          <div style="width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #000000, #333333); color: #FFFFFF; display: flex; align-items: center; justify-content: center; margin-right: 16px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                              ${icon}
                          </div>
                          <div style="font-weight: 500; font-size: 16px; color: #000000;">${title}</div>
                      </div>
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                  `;
  
                  card.addEventListener('click', onClick);
                  console.log(`Action card created: ${title}`);
                  return card;
              }
  
              try {
                  const supportCard = createActionCard(
                      '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path><circle cx="12" cy="10" r="1"></circle><circle cx="8" cy="10" r="1"></circle><circle cx="16" cy="10" r="1"></circle></svg>',
                      'Chat with support',
                      () => showScreen('support')
                  );
  
                  const demoCard = createActionCard(
                      '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M2 12h20M12 6a4 4 0 0 0-4 4v4a4 4 0 0 0 8 0v-4a4 4 0 0 0-4-4z"></path></svg>',
                      'Book a Demo',
                      () => showScreen('book-demo')
                  );
  
                  const callCard = createActionCard(
                      '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>',
                      'Request a Call',
                      () => showScreen('call-me')
                  );
  
                  actionsSection.appendChild(supportCard);
                  actionsSection.appendChild(demoCard);
                  actionsSection.appendChild(callCard);
  
                  contentArea.appendChild(actionsSection);
                  console.log('Actions section appended to contentArea');
              } catch (error) {
                  console.error('Error in showHomeScreen:', error);
              }
          }
  
          function showSupportScreen(contentArea) {
              console.log('showSupportScreen called');
              const chatContainer = document.createElement('div');
              chatContainer.style.display = 'flex';
              chatContainer.style.flexDirection = 'column';
              chatContainer.style.height = '100%';
  
              const messagesContainer = document.createElement('div');
              messagesContainer.style.flex = '1';
              messagesContainer.style.overflowY = 'auto';
              messagesContainer.style.padding = '24px';
  
              const welcomeMessage = document.createElement('div');
              welcomeMessage.style.display = 'none';
              welcomeMessage.style.marginBottom = '20px';
  
              const welcomeAvatar = document.createElement('div');
              welcomeAvatar.style.width = '32px';
              welcomeAvatar.style.height = '32px';
              welcomeAvatar.style.borderRadius = '50%';
              welcomeAvatar.style.backgroundColor = '#000000';
              welcomeAvatar.style.background = 'linear-gradient(135deg, #000000, #333333)';
              welcomeAvatar.style.color = '#FFFFFF';
              welcomeAvatar.style.display = 'flex';
              welcomeAvatar.style.alignItems = 'center';
              welcomeAvatar.style.justifyContent = 'center';
              welcomeAvatar.style.marginRight = '12px';
              welcomeAvatar.style.flexShrink = '0';
              welcomeAvatar.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>';
  
              const messageContent = document.createElement('div');
              messageContent.style.maxWidth = '80%';
  
              const messageName = document.createElement('div');
              messageName.style.fontWeight = '600';
              messageName.style.fontSize = '13px';
              messageName.style.marginBottom = '6px';
              messageName.style.color = '#666666';
              messageName.textContent = config.features?.chat?.agentName || 'Support';
  
              const messageText = document.createElement('div');
              messageText.style.padding = '12px 16px';
              messageText.style.backgroundColor = '#E0E0E0';
              messageText.style.borderRadius = '0 16px 16px 16px';
              messageText.style.fontSize = '14px';
              messageText.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.1)';
              messageText.style.lineHeight = '1.5';
              messageText.style.color = '#000000';
              messageText.textContent = config.features?.chat?.greeting || 'Hi there! 👋 How can I help you today?';
  
              messageContent.appendChild(messageName);
              messageContent.appendChild(messageText);
              welcomeMessage.appendChild(welcomeAvatar);
              welcomeMessage.appendChild(messageContent);
  
              const typingIndicator = document.createElement('div');
              typingIndicator.style.display = 'flex';
              typingIndicator.style.marginBottom = '20px';
  
              const typingAvatar = welcomeAvatar.cloneNode(true);
              const typingBubble = document.createElement('div');
              typingBubble.classList.add('typing-indicator');
  
              typingIndicator.appendChild(typingAvatar);
              typingIndicator.appendChild(typingBubble);
              messagesContainer.appendChild(typingIndicator);
              messagesContainer.appendChild(welcomeMessage);
  
              setTimeout(() => {
                  typingIndicator.style.display = 'none';
                  welcomeMessage.style.display = 'flex';
                  welcomeMessage.classList.add('message-fade-in');
                  messagesContainer.scrollTop = messagesContainer.scrollHeight;
              }, 2000);
  
              // Improved chat input area with rounded container
              const inputArea = document.createElement('div');
              inputArea.classList.add('chat-input-container');
  
              const emojiButton = document.createElement('button');
              emojiButton.classList.add('chat-emoji-button');
              emojiButton.setAttribute('aria-label', 'Add emoji');
              emojiButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>';
  
              const emojiMenu = document.createElement('div');
              emojiMenu.classList.add('emoji-menu');
              emojiMenu.innerHTML = `
                  <span>😊</span><span>👍</span><span>😂</span><span>❤️</span><span>😢</span><span>😡</span>
              `;
              inputArea.appendChild(emojiMenu);
  
              emojiButton.addEventListener('click', () => {
                  emojiMenu.style.display = emojiMenu.style.display === 'block' ? 'none' : 'block';
              });
  
              emojiMenu.querySelectorAll('span').forEach(span => {
                  span.addEventListener('click', () => {
                      chatInput.value += span.textContent;
                      emojiMenu.style.display = 'none';
                      chatInput.dispatchEvent(new Event('input'));
                  });
              });
  
              const chatInput = document.createElement('input');
              chatInput.type = 'text';
              chatInput.classList.add('chat-input');
              chatInput.placeholder = config.chatConfig?.inputPlaceholder || 'Type your message...';
              chatInput.setAttribute('aria-label', 'Type your message');
  
              const sendButton = document.createElement('button');
              sendButton.classList.add('chat-send-button');
              sendButton.setAttribute('aria-label', 'Send message');
              sendButton.style.display = 'none';
              sendButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>';
  
              chatInput.addEventListener('input', () => {
                  sendButton.style.display = chatInput.value.trim() ? 'flex' : 'none';
              });
  
              function sendMessage() {
                  const message = chatInput.value.trim();
                  if (message) {
                      const userMessageElement = document.createElement('div');
                      userMessageElement.style.display = 'flex';
                      userMessageElement.style.flexDirection = 'row-reverse';
                      userMessageElement.style.marginBottom = '20px';
  
                      const userMessageContent = document.createElement('div');
                      userMessageContent.classList.add('user-message-bubble');
                      userMessageContent.textContent = message;
  
                      userMessageElement.appendChild(userMessageContent);
                      messagesContainer.appendChild(userMessageElement);
                      userMessageElement.classList.add('message-fade-in');
  
                      chatInput.value = '';
                      sendButton.style.display = 'none';
                      messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
                      trackInteraction('chat_message_sent', { message });
  
                      const responseTypingIndicator = document.createElement('div');
                      responseTypingIndicator.style.display = 'flex';
                      responseTypingIndicator.style.marginBottom = '20px';
  
                      const responseTypingAvatar = welcomeAvatar.cloneNode(true);
                      const responseTypingBubble = document.createElement('div');
                      responseTypingBubble.classList.add('typing-indicator');
  
                      responseTypingIndicator.appendChild(responseTypingAvatar);
                      responseTypingIndicator.appendChild(responseTypingBubble);
                      messagesContainer.appendChild(responseTypingIndicator);
                      messagesContainer.scrollTop = messagesContainer.scrollHeight;
  
                      setTimeout(() => {
                          responseTypingIndicator.style.display = 'none';
  
                          const agentResponse = document.createElement('div');
                          agentResponse.style.display = 'flex';
                          agentResponse.style.marginBottom = '20px';
  
                          const responseAvatar = welcomeAvatar.cloneNode(true);
                          const responseContent = document.createElement('div');
                          responseContent.style.maxWidth = '80%';
  
                          const responseName = document.createElement('div');
                          responseName.style.fontWeight = '600';
                          responseName.style.fontSize = '13px';
                          responseName.style.marginBottom = '6px';
                          responseName.style.color = '#666666';
                          responseName.textContent = config.features?.chat?.agentName || 'Support';
  
                          const responseText = document.createElement('div');
                          responseText.classList.add('agent-message-bubble');
                          responseText.textContent = 'Thank you for your message. Our team will get back to you shortly.';
  
                          responseContent.appendChild(responseName);
                          responseContent.appendChild(responseText);
                          agentResponse.appendChild(responseAvatar);
                          agentResponse.appendChild(responseContent);
                          messagesContainer.appendChild(agentResponse);
                          agentResponse.classList.add('message-fade-in');
                          messagesContainer.scrollTop = messagesContainer.scrollHeight;
                      }, 2000);
                  }
              }
  
              chatInput.addEventListener('keypress', (e) => {
                  if (e.key === 'Enter') sendMessage();
              });
              sendButton.addEventListener('click', sendMessage);
  
              inputArea.appendChild(emojiButton);
              inputArea.appendChild(chatInput);
              inputArea.appendChild(sendButton);
              chatContainer.appendChild(messagesContainer);
              chatContainer.appendChild(inputArea);
              contentArea.appendChild(chatContainer);
          }
  
          function showBookDemoScreen(contentArea) {
              console.log('showBookDemoScreen called');
              const iframeContainer = document.createElement('div');
              iframeContainer.style.height = '100%';
              iframeContainer.style.width = '100%';
  
              const iframe = document.createElement('iframe');
              iframe.src = 'https://calendly.com/junior-hallberg-dealfront/30min?hide_gdpr_banner=1';
              iframe.style.width = '100%';
              iframe.style.height = '100%';
              iframe.style.border = 'none';
              iframe.style.backgroundColor = '#F5F5F5';
  
              iframeContainer.appendChild(iframe);
              contentArea.appendChild(iframeContainer);
          }
  
          function showCallMeScreen(contentArea) {
              console.log('showCallMeScreen called');
              const callContainer = document.createElement('div');
              callContainer.style.padding = '32px';
              callContainer.style.height = '100%';
              callContainer.style.display = 'flex';
              callContainer.style.flexDirection = 'column';
              callContainer.style.justifyContent = 'center';
              callContainer.id = 'call-me-container';
  
              const title = document.createElement('h2');
              title.style.fontSize = '24px';
              title.style.fontWeight = '600';
              title.style.marginBottom = '16px';
              title.style.color = '#000000';
              title.textContent = config.features?.callMe?.messages?.title || 'Get a call from Martin';
  
              const description = document.createElement('p');
              description.style.fontSize = '16px';
              description.style.marginBottom = '24px';
              description.style.color = '#666666';
              description.style.lineHeight = '1.5';
              description.textContent = config.features?.callMe?.messages?.description || 'Enter your phone number and Martin will call you in the next 3 minutes.';
  
              const form = document.createElement('form');
              form.style.display = 'flex';
              form.style.flexDirection = 'column';
              form.style.gap = '16px';
  
              const phoneField = document.createElement('input');
              phoneField.type = 'tel';
              phoneField.placeholder = 'Your phone number';
              phoneField.setAttribute('aria-label', 'Your phone number');
              phoneField.style.padding = '12px 16px';
              phoneField.style.border = '1px solid #000000';
              phoneField.style.borderRadius = '8px';
              phoneField.style.fontSize = '14px';
              phoneField.style.backgroundColor = '#FFFFFF';
              phoneField.style.color = '#000000';
              phoneField.style.outline = 'none';
              phoneField.style.boxShadow = '0 1px 2px rgba(0, 0, 0, 0.1)';
  
              const submitButton = document.createElement('button');
              submitButton.type = 'submit';
              submitButton.textContent = 'Request Call';
              submitButton.setAttribute('aria-label', 'Request call');
              submitButton.style.padding = '12px 16px';
              submitButton.style.backgroundColor = '#000000';
              submitButton.style.background = 'linear-gradient(135deg, #000000, #333333)';
              submitButton.style.color = '#FFFFFF';
              submitButton.style.border = 'none';
              submitButton.style.borderRadius = '8px';
              submitButton.style.cursor = 'pointer';
              submitButton.style.fontSize = '14px';
              submitButton.style.fontWeight = '500';
              submitButton.style.marginTop = '8px';
              submitButton.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
              submitButton.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';
  
              submitButton.addEventListener('mouseover', () => {
                  submitButton.style.transform = 'translateY(-2px)';
                  submitButton.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
              });
              submitButton.addEventListener('mouseout', () => {
                  submitButton.style.transform = 'translateY(0)';
                  submitButton.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
              });
  
              form.addEventListener('submit', (e) => {
                  e.preventDefault();
                  const phone = phoneField.value.trim();
                  if (phone) {
                      trackInteraction('call_me_submitted', { phone });
                      
                      // Update the existing container instead of creating a new one
                      callContainer.innerHTML = '';
                      
                      const successIcon = document.createElement('div');
                      successIcon.style.width = '64px';
                      successIcon.style.height = '64px';
                      successIcon.style.borderRadius = '50%';
                      successIcon.style.backgroundColor = '#000000';
                      successIcon.style.background = 'linear-gradient(135deg, #000000, #333333)';
                      successIcon.style.color = '#FFFFFF';
                      successIcon.style.display = 'flex';
                      successIcon.style.alignItems = 'center';
                      successIcon.style.justifyContent = 'center';
                      successIcon.style.marginBottom = '24px';
                      successIcon.style.marginLeft = 'auto';
                      successIcon.style.marginRight = 'auto';
                      successIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
  
                      const successTitle = document.createElement('h2');
                      successTitle.style.fontSize = '24px';
                      successTitle.style.fontWeight = '600';
                      successTitle.style.marginBottom = '16px';
                      successTitle.style.color = '#000000';
                      successTitle.style.textAlign = 'center';
                      successTitle.textContent = 'Request Received!';
  
                      const successMessage = document.createElement('p');
                      successMessage.style.fontSize = '16px';
                      successMessage.style.marginBottom = '24px';
                      successMessage.style.color = '#666666';
                      successMessage.style.lineHeight = '1.5';
                      successMessage.style.textAlign = 'center';
                      successMessage.textContent = "We'll call you as soon as possible.";
  
                      const backButton = document.createElement('button');
                      backButton.textContent = 'Back to Home';
                      backButton.setAttribute('aria-label', 'Back to home');
                      backButton.style.padding = '12px 24px';
                      backButton.style.backgroundColor = '#000000';
                      backButton.style.background = 'linear-gradient(135deg, #000000, #333333)';
                      backButton.style.color = '#FFFFFF';
                      backButton.style.border = 'none';
                      backButton.style.borderRadius = '8px';
                      backButton.style.cursor = 'pointer';
                      backButton.style.fontSize = '14px';
                      backButton.style.fontWeight = '500';
                      backButton.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
                      backButton.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';
                      backButton.style.margin = '0 auto';
                      backButton.style.display = 'block';
  
                      backButton.addEventListener('mouseover', () => {
                          backButton.style.transform = 'translateY(-2px)';
                          backButton.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
                      });
                      backButton.addEventListener('mouseout', () => {
                          backButton.style.transform = 'translateY(0)';
                          backButton.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.1)';
                      });
                      backButton.addEventListener('click', () => showScreen('home', 'back'));
  
                      callContainer.appendChild(successIcon);
                      callContainer.appendChild(successTitle);
                      callContainer.appendChild(successMessage);
                      callContainer.appendChild(backButton);
                  }
              });
  
              form.appendChild(phoneField);
              form.appendChild(submitButton);
              callContainer.appendChild(title);
              callContainer.appendChild(description);
              callContainer.appendChild(form);
              contentArea.appendChild(callContainer);
          }
  
          // Add click outside to close functionality
          document.addEventListener('click', (e) => {
              if (content.style.display !== 'none') {
                  let targetElement = e.target;
                  let isClickInside = false;
                  
                  while (targetElement != null) {
                      if (targetElement === container) {
                          isClickInside = true;
                          break;
                      }
                      targetElement = targetElement.parentElement;
                  }
                  
                  if (!isClickInside) {
                      // Add exit animation
                      content.style.animation = 'widgetEntranceAnimation 0.3s reverse forwards';
                      
                      // Animate the arrow rotation back
                      const arrowIcon = document.createElement('div');
                      arrowIcon.innerHTML = chatIconSVG;
                      arrowIcon.style.animation = 'arrowRotateUp 0.3s forwards';
                      button.innerHTML = '';
                      button.appendChild(arrowIcon.firstChild);
                      
                      // Hide content after animation completes
                      setTimeout(() => {
                          content.style.display = 'none';
                          content.classList.remove('widget-entrance');
                          content.style.animation = '';
                      }, 300);
                      
                      trackInteraction('widget_closed_outside_click');
                  }
              }
          });
  
          button.addEventListener('click', (e) => {
              e.stopPropagation(); // Prevent the document click handler from firing
              if (content.style.display === 'none') {
                  // Show widget with entrance animation
                  content.style.display = 'flex';
                  content.classList.add('widget-entrance');
                  
                  // Animate the arrow rotation
                  const arrowIcon = document.createElement('div');
                  arrowIcon.innerHTML = arrowDownSVG;
                  arrowIcon.style.animation = 'arrowRotateDown 0.3s forwards';
                  button.innerHTML = '';
                  button.appendChild(arrowIcon.firstChild);
                  
                  // Force render home screen with explicit call
                  showScreen('home');
                  
                  // Add visibility verification
                  console.log('Widget opened, content display:', content.style.display);
                  
                  trackInteraction('widget_opened');
              } else {
                  // Add exit animation
                  content.style.animation = 'widgetEntranceAnimation 0.3s reverse forwards';
                  
                  // Animate the arrow rotation back
                  const arrowIcon = document.createElement('div');
                  arrowIcon.innerHTML = chatIconSVG;
                  arrowIcon.style.animation = 'arrowRotateUp 0.3s forwards';
                  button.innerHTML = '';
                  button.appendChild(arrowIcon.firstChild);
                  
                  // Hide content after animation completes
                  setTimeout(() => {
                      content.style.display = 'none';
                      content.classList.remove('widget-entrance');
                      content.style.animation = '';
                  }, 300);
                  
                  trackInteraction('widget_closed');
              }
          });
  
          backButton.addEventListener('click', () => showScreen('home', 'back'));
  
          // Show widget on page load
          setTimeout(() => {
              content.style.display = 'flex';
              content.classList.add('widget-entrance');
              
              // Animate the arrow rotation
              const arrowIcon = document.createElement('div');
              arrowIcon.innerHTML = arrowDownSVG;
              arrowIcon.style.animation = 'arrowRotateDown 0.3s forwards';
              button.innerHTML = '';
              button.appendChild(arrowIcon.firstChild);
              
              // Force render home screen with explicit call
              showScreen('home');
              
              trackInteraction('widget_auto_opened');
          }, 1000); // Small delay to ensure everything is loaded
      }
  
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
          initWidget();
      } else {
          window.addEventListener('DOMContentLoaded', initWidget);
      }        
  })();
  
</body>
</html>